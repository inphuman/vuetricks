---
layout: post
title: Реактивность в Vue 3
tags: [Vue 3, реактивность]
comments: false
---

Реактивность. Это одна из самых удобных функций JS-фреймворков. Что это такое, и как это работает в Vue 3?

## Предпосылки для дальнейшего ознакомления с информацией

- Понимание основ JavaScript и JS объектов
- Понимание основ Vue.js

## Что такое реактивность?

Реактивность - это парадигма программирования, которая позволяет нам приспосабливаться к изменениям декларативным
образом.

Мы говорим, что значение является реактивным, если оно может обновляться в ответ на изменения значений, от которых оно
зависит. Что мы подразумеваем под словом "зависит от"?

Давайте рассмотрим пример:

```js
let val1 = 2
let val2 = 3
let sum = val1 + val2
```

Значение суммы всегда определяется значениями val1 и val2, поэтому мы говорим, что сумма зависит от `val1` и `val2`.

Что происходит с суммой при изменении одного из значений, от которых она зависит? В обычном JavaScript она остается неизменной.

```js
console.log(sum) // 5

val1 = 3

console.log(sum) // 5
```

Но если сумма была бы реактивной:

```js
console.log(sum) // 5

val1 = 3

console.log(sum) // Sum is 6!
```

Значение суммы будет меняться в ответ на изменение величины, от которой она зависит.

## Что нужно Vue, чтобы сделать значение реактивным?

Vue необходимо знать:

какие зависимости имеет данное значение.
когда эти зависимости изменяются.
Vue также должен уметь пересчитывать значения при изменении их зависимостей.

## Как Vue узнает об изменении зависимостей

Vue оборачивает объект данных всех компонентов с помощью [ES6-прокси](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy). Прокси - это объект, который обертывает целевой объект.

Это важно, поскольку все реактивные значения зависят (прямо или нет) от свойств объекта данных компонента.

Прокси позволяют перехватывать все запросы на получение или установку свойств объекта. Они также позволяют запускать любой код в ответ на эти запросы.

Благодаря этому, когда код пытается изменить одно из свойств объекта данных, Vue перехватывает его и знает об этом.

Затем Vue может пересчитать все функции, которые зависят от этого значения. Но как Vue узнает, какие функции зависят от каких значений?

## Как Vue узнает, какие зависимости принадлежат значению

Чтобы сделать наше значение реактивным, нам нужно обернуть его в функцию. Для иллюстрации снова используем `sum`:

```js
// we need to go from
let val1 = 2
let val2 = 3
let sum = val1 + val2

// to
const updateSum = () => {
 sum = val1 + val2
}
```

Затем Vue оборачивает все такие функции в effect. Effect - это функция, которая принимает в качестве аргумента другую
функцию. Затем Vue вызывает effect вместо этой функции.

Когда Vue вызывает effect, effect делает следующее:

- Записывает, что она запущена.
- Вызывает функцию, полученную в качестве аргумента.
- Удаляет себя из списка запущенных эффектов после завершения функции.

Помните, что все исходные значения поступают из прокси (компонент данных)? Во время выполнения функции, которую он
обертывает, эффекту понадобится свойство из объекта данных, и он попытается его прочитать.

Прокси перехватит этот запрос на чтение. Vue проверяет, какой effect запущен в данный момент. Затем он записывает, что
effect зависит от свойства, которое он пытался прочитать. Так Vue узнает, какие значения зависят от каких свойств.

## Как же Vue узнает, когда нужно повторно запускать функции, возвращающие зависимые значения?

Ответ снова заключается в магии прокси. Прокси могут перехватывать запросы на установку значений свойств.

Помните, что теперь у нас есть запись effects, а также значений, от которых они зависят. Когда значение свойства в
данных изменяется, Vue нужно сделать одно: проверить эту запись и обновить исходное значение.

Затем Vue может повторно запустить все effects, которые зависят от него, и таким образом обновить значения.